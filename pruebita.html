<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flujo Circular de la Econom√≠a ¬∑ Modelo interactivo profesional</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #f0f4fa 0%, #e6ecf5 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card-economia {
            max-width: 1000px;
            width: fit-content;
            margin: 2rem auto;
            background: rgba(255,255,255,0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 48px;
            padding: 30px 30px 40px 30px;
            box-shadow: 0 30px 50px rgba(0,20,40,0.25), inset 2px 2px 5px rgba(255,255,255,0.6), inset -3px -3px 8px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.7);
        }

        .flujo-circular {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .info-flujo {
            text-align: center;
            max-width: 650px;
            margin-bottom: 20px;
        }

        .info-flujo h2 {
            font-size: 2.2rem;
            font-weight: 600;
            margin: 0 0 10px 0;
            background: linear-gradient(135deg, #1e2b3c, #2c3e50);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .info-flujo p {
            color: #2c3e50;
            font-size: 1rem;
            line-height: 1.5;
            background: rgba(255,255,255,0.5);
            padding: 12px 22px;
            border-radius: 60px;
            backdrop-filter: blur(4px);
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.05);
        }

        #canvasFlujo {
            display: block;
            width: 100%;
            height: auto;
            background: #ffffffd9;
            border-radius: 42px;
            box-shadow: 0 20px 35px rgba(0,20,30,0.2), inset 0 0 0 1px rgba(255,255,255,1), inset 0 0 0 2px rgba(0,0,0,0.02);
            transition: all 0.2s ease;
            cursor: pointer;
            touch-action: none; /* mejorar interacci√≥n t√°ctil */
        }

        .panel-control {
            margin-top: 25px;
            width: 100%;
            background: rgba(230, 240, 255, 0.5);
            backdrop-filter: blur(8px);
            border-radius: 48px;
            padding: 20px 30px;
            border: 1px solid rgba(255,255,255,0.7);
            box-shadow: inset 0 2px 5px rgba(255,255,255,0.8), 0 10px 15px -8px rgba(0,20,30,0.2);
        }

        .param-sliders {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            align-items: center;
        }

        .slider-item {
            flex: 1 1 180px;
            min-width: 160px;
        }

        .slider-item label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #1e3b4f;
            margin-bottom: 6px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .slider-item label i {
            font-size: 1.2rem;
        }

        input[type=range] {
            width: 100%;
            height: 7px;
            background: linear-gradient(90deg, #7495aa, #aac3d4);
            border-radius: 12px;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,20,30,0.3), 0 0 0 2px #1e3b4f;
            cursor: grab;
            transition: 0.1s;
        }

        .info-footer {
            margin-top: 18px;
            font-size: 1.1rem;
            font-weight: 500;
            background: #1e2f3f;
            padding: 12px 25px;
            border-radius: 60px;
            color: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            width: fit-content;
            align-self: center;
        }

        #infoFlujo {
            background: #f6c7a2a0;
            padding: 4px 15px;
            border-radius: 40px;
            color: #1d2c3a;
            font-weight: 600;
            margin-left: 5px;
        }

        .monetary-badge {
            display: inline-block;
            background: #22772230;
            border-radius: 20px;
            padding: 2px 12px;
            font-size: 0.85rem;
            font-weight: 400;
            margin: 0 4px;
        }

        .reset-btn {
            background: white;
            border: none;
            padding: 8px 20px;
            border-radius: 40px;
            font-weight: 600;
            color: #1e3b4f;
            cursor: pointer;
            box-shadow: 0 5px 10px rgba(0,0,0,0.05);
            transition: 0.15s;
            border: 1px solid #ffffff;
            margin-left: 15px;
        }

        .reset-btn:hover {
            background: #e3ecf5;
            box-shadow: 0 8px 15px rgba(0,30,50,0.15);
            transform: scale(0.98);
        }
    </style>
</head>
<body>
    <div class="card-economia">
        <div class="flujo-circular" id="flujo">
            <div class="info-flujo">
                <h2>‚öôÔ∏è Flujo Circular de la Econom√≠a</h2>
                <p>
                    Modelo interactivo donde se muestra c√≥mo interact√∫an las Familias y las Empresas
                    mediante el flujo real (bienes y trabajo) y el flujo monetario (dinero).
                    Haz clic en cada sector para ver c√≥mo funciona. Ajusta los par√°metros abajo.
                </p>
            </div>

            <canvas id="canvasFlujo" width="700" height="400"></canvas>

            <div class="panel-control">
                <div class="param-sliders">
                    <div class="slider-item">
                        <label><span style="font-size:1.3rem;">üè†</span> Gasto familias (consumo)</label>
                        <input type="range" id="sliderFam" min="0.2" max="1.8" value="1.0" step="0.01">
                    </div>
                    <div class="slider-item">
                        <label><span style="font-size:1.3rem;">üè≠</span> Inversi√≥n empresas</label>
                        <input type="range" id="sliderEmp" min="0.2" max="1.8" value="1.0" step="0.01">
                    </div>
                    <div class="slider-item">
                        <label><span style="font-size:1.3rem;">üí∞</span> Salarios / Renta</label>
                        <input type="range" id="sliderSal" min="0.2" max="1.8" value="1.0" step="0.01">
                    </div>
                    <button class="reset-btn" id="resetParams">‚Ü∫ Restablecer</button>
                </div>
            </div>

            <p class="info-footer">
                <strong>üîç Informaci√≥n:</strong> <span id="infoFlujo">Haz clic en un elemento del modelo.</span>
            </p>
        </div>
    </div>

    <script>
        (function() {
            const canvas = document.getElementById('canvasFlujo');
            const ctx = canvas.getContext('2d');
            const infoSpan = document.getElementById('infoFlujo');

            // par√°metros modificables (escalas visuales)
            let paramFam = 1.0;   // intensidad flujo consumo (fam -> emp)
            let paramEmp = 1.0;   // intensidad flujo inversi√≥n/bienes (emp -> fam)
            let paramSal = 1.0;   // intensidad flujo salarios (emp -> fam, monetario)

            // elementos DOM
            const sliderFam = document.getElementById('sliderFam');
            const sliderEmp = document.getElementById('sliderEmp');
            const sliderSal = document.getElementById('sliderSal');
            const resetBtn = document.getElementById('resetParams');

            // posiciones de los sectores (para detecci√≥n de clics)
            const sectors = {
                familias: { x: 200, y: 200, w: 120, h: 100 },
                empresas: { x: 450, y: 200, w: 120, h: 100 }
            };

            // ------------------------------------------------------------------
            // 1. DIBUJO PRINCIPAL (animaci√≥n suave, se actualiza con cada cambio)
            // ------------------------------------------------------------------
            function drawModel() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ---- sombras y fondo semi-transparente suave ----
                ctx.shadowColor = 'rgba(0,15,30,0.2)';
                ctx.shadowBlur = 16;
                ctx.shadowOffsetX = 4;
                ctx.shadowOffsetY = 4;

                // ---------- FAMILIAS (izquierda) ----------
                ctx.fillStyle = '#a2d9f5';
                ctx.strokeStyle = '#1a4863';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.roundRect(sectors.familias.x, sectors.familias.y, sectors.familias.w, sectors.familias.h, 28);
                ctx.fill();
                ctx.stroke();
                ctx.shadowBlur = 8; // reducimos sombra para texto
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.font = 'bold 16px "Inter", "Segoe UI", sans-serif';
                ctx.fillStyle = '#113946';
                ctx.fillText('üè† FAMILIAS', sectors.familias.x + 15, sectors.familias.y + 45);
                ctx.font = '500 13px "Inter", sans-serif';
                ctx.fillStyle = '#1d4e63';
                ctx.fillText('trabajo ¬∑ consumo', sectors.familias.x + 18, sectors.familias.y + 75);

                // ---------- EMPRESAS (derecha) ----------
                ctx.fillStyle = '#c7e9b0';
                ctx.strokeStyle = '#235b2b';
                ctx.beginPath();
                ctx.roundRect(sectors.empresas.x, sectors.empresas.y, sectors.empresas.w, sectors.empresas.h, 28);
                ctx.fill();
                ctx.stroke();
                ctx.fillStyle = '#1f5420';
                ctx.font = 'bold 16px "Inter", "Segoe UI", sans-serif';
                ctx.fillText('üè≠ EMPRESAS', sectors.empresas.x + 18, sectors.empresas.y + 45);
                ctx.font = '500 13px "Inter", sans-serif';
                ctx.fillStyle = '#1e4a2c';
                ctx.fillText('bienes ¬∑ salarios', sectors.empresas.x + 20, sectors.empresas.y + 75);

                // ---------- FLUJOS (flechas interactivas) ----------
                ctx.shadowBlur = 12;
                ctx.shadowColor = 'rgba(0,70,100,0.25)';
                ctx.lineWidth = 4;
                ctx.lineCap = 'round';

                // ---- FLUJO REAL (bienes/servicios y trabajo) - color azul ----
                // empresas -> familias: bienes y servicios (real)
                let realIntensity = Math.min(1.2, paramEmp * 0.8 + 0.2);  // para anchura
                ctx.strokeStyle = '#217ca5';
                ctx.lineWidth = 3 + realIntensity * 4;
                drawCurvedArrow(380, 190, 290, 160, 0.2, '#217ca5', 'Bienes');
                // familias -> empresas: trabajo (real)
                ctx.strokeStyle = '#3b93b8';
                ctx.lineWidth = 3 + paramFam * 3.5;
                drawCurvedArrow(260, 270, 400, 240, -0.15, '#3b93b8', 'Trabajo');

                // ---- FLUJO MONETARIO (dinero) - color verde y morado ----
                // familias -> empresas: pago consumo (monetario)
                ctx.strokeStyle = '#2b7a4e';
                ctx.lineWidth = 3 + paramFam * 4.5;
                drawCurvedArrow(280, 200, 430, 210, 0.3, '#2b7a4e', 'Gasto $');

                // empresas -> familias: salarios (monetario)  (inverso)
                ctx.strokeStyle = '#9b5e9b';
                ctx.lineWidth = 3 + paramSal * 4.5;
                drawCurvedArrow(410, 280, 250, 250, -0.25, '#9b5e9b', 'Salarios $');

                // ---- flujo adicional: inversi√≥n (empresas -> familias matizado) 
                if (paramEmp > 0.3) {
                    ctx.strokeStyle = '#b9784b';
                    ctx.lineWidth = 3 + paramEmp * 2.5;
                    drawCurvedArrow(430, 150, 280, 130, -0.1, '#b9784b', 'Inversi√≥n');
                }

                // ---- peque√±o recordatorio de intensidades ----
                ctx.shadowBlur = 0;
                ctx.font = '400 10px monospace';
                ctx.fillStyle = '#2c3e50';
                ctx.fillText('arrastra sliders', 540, 360);
            }

            // funci√≥n auxiliar para rect redondeado
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.moveTo(x + r, y);
                this.lineTo(x + w - r, y);
                this.quadraticCurveTo(x + w, y, x + w, y + r);
                this.lineTo(x + w, y + h - r);
                this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                this.lineTo(x + r, y + h);
                this.quadraticCurveTo(x, y + h, x, y + h - r);
                this.lineTo(x, y + r);
                this.quadraticCurveTo(x, y, x + r, y);
                return this;
            };

            // dibujar flecha curva con etiqueta
            function drawCurvedArrow(startX, startY, endX, endY, offsetPct, color, label) {
                const midX = (startX + endX) / 2 + 30 * offsetPct;
                const midY = (startY + endY) / 2 - 20 * offsetPct;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.quadraticCurveTo(midX, midY, endX, endY);
                ctx.strokeStyle = color;
                ctx.stroke();

                // dibujar punta de flecha (tri√°ngulo)
                let angle = Math.atan2(endY - midY, endX - midX); // aproximado
                let arrowSize = 14;
                let arrowX = endX - 10 * Math.cos(angle);
                let arrowY = endY - 10 * Math.sin(angle);

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(arrowX, arrowY);
                ctx.lineTo(arrowX - arrowSize * 0.6 * Math.cos(angle - 0.8), arrowY - arrowSize * 0.6 * Math.sin(angle - 0.8));
                ctx.lineTo(arrowX - arrowSize * 0.6 * Math.cos(angle + 0.8), arrowY - arrowSize * 0.6 * Math.sin(angle + 0.8));
                ctx.closePath();
                ctx.fill();

                // etiqueta peque√±a
                ctx.font = 'bold 11px "Inter", sans-serif';
                ctx.fillStyle = '#111111';
                ctx.shadowBlur = 6;
                ctx.shadowColor = 'white';
                ctx.fillText(label, midX - 20, midY - 8);
            }

            // --------------------------------------------------------------
            // 2. INTERACCI√ìN: clic en canvas (detectar sector)
            // --------------------------------------------------------------
            function handleCanvasClick(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;

                const mouseX = (e.clientX - rect.left) * scaleX;
                const mouseY = (e.clientY - rect.top) * scaleY;

                // comprobar familias
                if (mouseX >= sectors.familias.x && mouseX <= sectors.familias.x + sectors.familias.w &&
                    mouseY >= sectors.familias.y && mouseY <= sectors.familias.y + sectors.familias.h) {
                    infoSpan.innerText = 'üè† FAMILIAS: Ofrecen trabajo y consumen bienes. Flujo monetario: reciben salarios, pagan consumo.';
                    return;
                }
                // comprobar empresas
                if (mouseX >= sectors.empresas.x && mouseX <= sectors.empresas.x + sectors.empresas.w &&
                    mouseY >= sectors.empresas.y && mouseY <= sectors.empresas.y + sectors.empresas.h) {
                    infoSpan.innerText = 'üè≠ EMPRESAS: Contratan trabajo y producen bienes. Pagan salarios, reciben ingresos por ventas.';
                    return;
                }

                // detectar zonas de flujo aproximadas (adicional)
                if (mouseX > 300 && mouseX < 430 && mouseY > 140 && mouseY < 220) {
                    infoSpan.innerText = 'üí∏ Flujo monetario (consumo) / real (bienes) ‚Äî par√°metros activos.';
                } else if (mouseX > 240 && mouseX < 400 && mouseY > 220 && mouseY < 310) {
                    infoSpan.innerText = '‚õìÔ∏è Flujo real (trabajo) y monetario (salarios) ‚Äî ajusta con sliders.';
                } else {
                    infoSpan.innerText = 'Haz clic en familias, empresas o flechas para m√°s detalle.';
                }
            }

            // --------------------------------------------------------------
            // 3. SLIDERS: actualizar par√°metros y redibujar
            // --------------------------------------------------------------
            function updateFromSliders() {
                paramFam = parseFloat(sliderFam.value);
                paramEmp = parseFloat(sliderEmp.value);
                paramSal = parseFloat(sliderSal.value);
                drawModel();
                // Opcional: mostrar valores en info (sin borrar √∫ltimo mensaje si no hay clic)
                // pero respetamos √∫ltimo clic. Mejor mantener.
            }

            sliderFam.addEventListener('input', updateFromSliders);
            sliderEmp.addEventListener('input', updateFromSliders);
            sliderSal.addEventListener('input', updateFromSliders);

            resetBtn.addEventListener('click', () => {
                sliderFam.value = '1.0';
                sliderEmp.value = '1.0';
                sliderSal.value = '1.0';
                updateFromSliders();
                infoSpan.innerText = 'Valores restablecidos a 1.0';
            });

            canvas.addEventListener('click', handleCanvasClick);

            // Dibujar inmediatamente
            updateFromSliders();

            // ajustar redibujado en resize de ventana (mantener calidad)
            window.addEventListener('resize', () => drawModel());

            // --------------------------------------------------------------
            // 4. MEJORA: mostrar descripci√≥n de par√°metros al pasar por sliders
            // --------------------------------------------------------------
            sliderFam.addEventListener('mouseenter', () => infoSpan.innerText = '‚¨Ü Gasto de familias: mayor consumo (flujo $ y real hacia empresas)');
            sliderEmp.addEventListener('mouseenter', () => infoSpan.innerText = '‚¨Ü Inversi√≥n empresarial: m√°s bienes producidos (flujo real)');
            sliderSal.addEventListener('mouseenter', () => infoSpan.innerText = '‚¨Ü Salarios: mayor renta para familias (flujo $)');
            sliderFam.addEventListener('mouseleave', () => infoSpan.innerText = 'Haz clic en un elemento del modelo.');
            sliderEmp.addEventListener('mouseleave', () => infoSpan.innerText = 'Haz clic en un elemento del modelo.');
            sliderSal.addEventListener('mouseleave', () => infoSpan.innerText = 'Haz clic en un elemento del modelo.');

        })();
    </script>
</body>
</html>